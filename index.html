<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>Market Dashboard</title>
    <link rel="stylesheet" href="css/style.css" />

    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <script src="js/tickers.js"></script>

    <script type="module">
      import {
        fetchSheetData,
        renderSheetContent,
      } from "./js/sheet-data-handler.js";
      import { initLiveMonitor } from "./js/live-monitor.js";

      // å¾“æ¥ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰å‘¼ã¹ã‚‹ã‚ˆã†ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
      window.fetchSheetData = fetchSheetData;
      window.renderSheetContent = renderSheetContent;
      window.initLiveMonitor = initLiveMonitor;
    </script>

    <script src="js/chart-settings.js"></script>
    <script src="js/app-config.js"></script>
    <script src="js/dashboard.js"></script>

    <script>
      window.addEventListener("load", async () => {
        if (window.initLiveMonitor) {
          window.initLiveMonitor();
        }
      });
    </script>
  </head>
  <body>
    <div class="header-controls">
      <div class="mode-selector">
        <button id="btn-open-settings">âš™ï¸ è¨­å®š</button>
        <button id="btn-single" onclick="changeMode('single')">Single</button>
        <button id="btn-simple" onclick="changeMode('simple')">Mini</button>
        <button id="btn-rich" onclick="changeMode('rich')">Rich</button>
      </div>

      <div
        class="right-controls"
        style="display: flex; gap: 8px; margin-left: auto"
      >
        <div class="theme-selector">
          <button
            id="btn-theme-toggle"
            onclick="toggleTheme()"
            title="Toggle Dark/Light Mode"
          >
            ğŸŒ“
          </button>
        </div>
        <div class="lang-selector">
          <button id="btn-ja" onclick="changeLang('ja')">JP</button>
          <button id="btn-en" onclick="changeLang('en')">EN</button>
        </div>
      </div>
    </div>

    <h2 class="section-title">Favorites</h2>
    <div id="favorite-grid" class="grid"></div>

    <h2 class="section-title">Market Overview</h2>
    <div id="chart-grid" class="grid"></div>

    <div id="settings-modal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h3>éŠ˜æŸ„ã®è¿½åŠ </h3>
          <span id="btn-close-modal" class="close-x">&times;</span>
        </div>

        <div class="modal-body">
          <div class="input-group">
            <label>è¡¨ç¤ºå</label>
            <input type="text" id="new-ticker-name" placeholder="ä¾‹: ãƒˆãƒ¨ã‚¿" />
          </div>
          <div class="input-group">
            <label>ã‚·ãƒ³ãƒœãƒ«</label>
            <input
              type="text"
              id="new-ticker-symbol"
              placeholder="ä¾‹: TSE:7203"
            />
          </div>
          <div class="input-group">
            <label>ã‚¹ã‚¿ã‚¤ãƒ«</label>
            <select id="new-ticker-view">
              <option value="single">Single Ticker (ãƒãƒƒã‚¸å‹)</option>
              <option value="simple">Mini Chart (ã‚·ãƒ³ãƒ—ãƒ«)</option>
              <option value="rich">Rich Detail (è©³ç´°)</option>
            </select>
          </div>
          <button id="add-ticker-btn" class="primary-btn">
            ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«è¿½åŠ 
          </button>

          <hr class="modal-divider" />

          <div class="setting-item">
            <p style="font-weight: bold; font-size: 0.9rem; margin-bottom: 8px">
              ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç®¡ç†
            </p>
            <div style="display: flex; align-items: center; gap: 10px">
              <button
                id="btn-save-layout"
                class="primary-btn"
                style="background: #2a2e39; flex: 1"
              >
                ç¾åœ¨ã®é…ç½®ã‚’ä¿å­˜
              </button>
              <span
                id="save-status-msg"
                style="font-size: 11px; color: #089981; display: none"
                >Saved!</span
              >
            </div>
          </div>

          <div
            class="setting-item"
            style="
              border-top: 1px solid #444;
              padding-top: 15px;
              margin-top: 15px;
            "
          >
            <p style="font-weight: bold; font-size: 0.9rem; margin-bottom: 8px">
              ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
            </p>
            <div style="display: flex; flex-direction: column; gap: 8px">
              <button
                id="btn-export-json"
                class="primary-btn"
                style="background: #2a2e39"
              >
                è¨­å®šã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãå‡ºã™
              </button>

              <button
                id="btn-import-trigger"
                class="primary-btn"
                style="background: #2a2e39"
              >
                ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã‚€
              </button>
              <input
                type="file"
                id="input-import-json"
                accept=".json"
                style="display: none"
              />
            </div>
          </div>

          <hr class="modal-divider" />

          <div class="danger-zone">
            <p>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</p>
            <button id="reset-all-btn" class="reset-btn">
              å…¨ã¦ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’åˆæœŸåŒ–
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
